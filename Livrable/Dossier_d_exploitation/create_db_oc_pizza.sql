
CREATE TABLE public.sizing (
                ref INTEGER NOT NULL,
                size VARCHAR(30) NOT NULL,
                CONSTRAINT sizing_pk PRIMARY KEY (ref)
);


CREATE TABLE public.order_status (
                code INTEGER NOT NULL,
                status VARCHAR(30) NOT NULL,
                CONSTRAINT order_status_pk PRIMARY KEY (code)
);


CREATE TABLE public.webuser_state (
                code INTEGER NOT NULL,
                state_desc VARCHAR(30) NOT NULL,
                CONSTRAINT webuser_state_pk PRIMARY KEY (code)
);


CREATE TABLE public.role (
                code INTEGER NOT NULL,
                role_desc VARCHAR(30) NOT NULL,
                CONSTRAINT role_pk PRIMARY KEY (code)
);


CREATE SEQUENCE public.units_id_seq;

CREATE TABLE public.units (
                id INTEGER NOT NULL DEFAULT nextval('public.units_id_seq'),
                type VARCHAR NOT NULL,
                CONSTRAINT units_pk PRIMARY KEY (id)
);


ALTER SEQUENCE public.units_id_seq OWNED BY public.units.id;

CREATE SEQUENCE public.invoice_invoice_id_seq_1;

CREATE TABLE public.invoice (
                number INTEGER NOT NULL DEFAULT nextval('public.invoice_invoice_id_seq_1'),
                sum REAL NOT NULL,
                payed BOOLEAN NOT NULL,
                CONSTRAINT invoice_pk PRIMARY KEY (number)
);


ALTER SEQUENCE public.invoice_invoice_id_seq_1 OWNED BY public.invoice.number;

CREATE SEQUENCE public.ingredient_ingredient_id_seq;

CREATE TABLE public.ingredient (
                igd_id INTEGER NOT NULL DEFAULT nextval('public.ingredient_ingredient_id_seq'),
                name VARCHAR(30) NOT NULL,
                unit_id INTEGER NOT NULL,
                CONSTRAINT ingredient_pk PRIMARY KEY (igd_id)
);


ALTER SEQUENCE public.ingredient_ingredient_id_seq OWNED BY public.ingredient.igd_id;

CREATE SEQUENCE public.pizza_id_seq;

CREATE TABLE public.pizza (
                number INTEGER NOT NULL DEFAULT nextval('public.pizza_id_seq'),
                name VARCHAR NOT NULL,
                CONSTRAINT pizza_pk PRIMARY KEY (number)
);


ALTER SEQUENCE public.pizza_id_seq OWNED BY public.pizza.number;

CREATE TABLE public.pricing (
                ref_pizza INTEGER NOT NULL,
                ref_sizing INTEGER NOT NULL,
                price NUMERIC(4,2) NOT NULL,
                CONSTRAINT pricing_pk PRIMARY KEY (ref_pizza, ref_sizing)
);


CREATE SEQUENCE public.address_id_seq_1;

CREATE TABLE public.address (
                id INTEGER NOT NULL DEFAULT nextval('public.address_id_seq_1'),
                zip VARCHAR NOT NULL,
                country VARCHAR NOT NULL,
                street VARCHAR NOT NULL,
                street_number VARCHAR,
                CONSTRAINT address_pk PRIMARY KEY (id)
);


ALTER SEQUENCE public.address_id_seq_1 OWNED BY public.address.id;

CREATE SEQUENCE public.pizzeria_pizzeria_id_seq_1_1_2;

CREATE TABLE public.pizzeria (
                number INTEGER NOT NULL DEFAULT nextval('public.pizzeria_pizzeria_id_seq_1_1_2'),
                name VARCHAR NOT NULL,
                address_id INTEGER NOT NULL,
                CONSTRAINT pizzeria_pk PRIMARY KEY (number)
);


ALTER SEQUENCE public.pizzeria_pizzeria_id_seq_1_1_2 OWNED BY public.pizzeria.number;

CREATE TABLE public.stocks (
                stock_id INTEGER NOT NULL,
                name VARCHAR(100) NOT NULL,
                pizzeria_number INTEGER NOT NULL,
                CONSTRAINT stocks_pk PRIMARY KEY (stock_id)
);


CREATE TABLE public.stock_ingredient (
                stock_id INTEGER NOT NULL,
                igd_id INTEGER NOT NULL,
                quantity INTEGER NOT NULL,
                CONSTRAINT stock_ingredient_pk PRIMARY KEY (stock_id, igd_id)
);


CREATE SEQUENCE public.memory_help_id_seq;

CREATE TABLE public.memory_help (
                id INTEGER NOT NULL DEFAULT nextval('public.memory_help_id_seq'),
                ref_pizzeria INTEGER NOT NULL,
                CONSTRAINT memory_help_pk PRIMARY KEY (id)
);


ALTER SEQUENCE public.memory_help_id_seq OWNED BY public.memory_help.id;

CREATE TABLE public.recipe (
                id INTEGER NOT NULL,
                name VARCHAR(30) NOT NULL,
                ref_pizza INTEGER NOT NULL,
                mm_helf_ref INTEGER NOT NULL,
                CONSTRAINT recipe_pk PRIMARY KEY (id)
);


CREATE TABLE public.recipe_ingredient (
                ingredient_id INTEGER NOT NULL,
                recipe_id INTEGER NOT NULL,
                quantity INTEGER DEFAULT 0 NOT NULL,
                CONSTRAINT recipe_ingredient_pk PRIMARY KEY (ingredient_id, recipe_id)
);


CREATE SEQUENCE public.menu_card_m_card_id_seq;

CREATE TABLE public.menu_card (
                id INTEGER NOT NULL DEFAULT nextval('public.menu_card_m_card_id_seq'),
                nom VARCHAR(100) NOT NULL,
                ref_pizzeria INTEGER NOT NULL,
                CONSTRAINT menu_card_pk PRIMARY KEY (id)
);


ALTER SEQUENCE public.menu_card_m_card_id_seq OWNED BY public.menu_card.id;

CREATE SEQUENCE public.description_id_seq;

CREATE TABLE public.description (
                id INTEGER NOT NULL DEFAULT nextval('public.description_id_seq'),
                description VARCHAR NOT NULL,
                ref_menu_card INTEGER NOT NULL,
                ref_pizza INTEGER NOT NULL,
                CONSTRAINT description_pk PRIMARY KEY (id)
);


ALTER SEQUENCE public.description_id_seq OWNED BY public.description.id;

CREATE SEQUENCE public.webuser_id_seq;

CREATE TABLE public.webuser (
                id INTEGER NOT NULL DEFAULT nextval('public.webuser_id_seq'),
                first_name VARCHAR(35) NOT NULL,
                last_name VARCHAR(35) NOT NULL,
                user_name VARCHAR(30) NOT NULL,
                password VARCHAR(100) NOT NULL,
                email VARCHAR(100) NOT NULL,
                phone VARCHAR,
                address_id INTEGER NOT NULL,
                webuser_state_code INTEGER NOT NULL,
                CONSTRAINT webuser_pk PRIMARY KEY (id)
);


ALTER SEQUENCE public.webuser_id_seq OWNED BY public.webuser.id;

CREATE TABLE public.customer (
                user_id INTEGER NOT NULL,
                customer_number VARCHAR NOT NULL,
                CONSTRAINT customer_pk PRIMARY KEY (user_id)
);


CREATE TABLE public.account (
                acc_id INTEGER NOT NULL,
                open DATE NOT NULL,
                closed DATE NOT NULL,
                isClosed BOOLEAN NOT NULL,
                ref_customer INTEGER NOT NULL,
                CONSTRAINT account_pk PRIMARY KEY (acc_id)
);


CREATE SEQUENCE public.purchase_order_purchase_id_seq;

CREATE SEQUENCE public.account_acc_id_seq_2;

CREATE TABLE public.purchase_order (
                purchase_id INTEGER NOT NULL DEFAULT nextval('public.purchase_order_purchase_id_seq'),
                order_date DATE NOT NULL,
                shipped BOOLEAN NOT NULL,
                shipTo VARCHAR NOT NULL,
                order_amount REAL NOT NULL,
                account_id INTEGER NOT NULL DEFAULT nextval('public.account_acc_id_seq_2'),
                invoice_number INTEGER NOT NULL,
                ref_pizzeria INTEGER NOT NULL,
                order_status_code INTEGER NOT NULL,
                CONSTRAINT purchase_order_pk PRIMARY KEY (purchase_id)
);


ALTER SEQUENCE public.purchase_order_purchase_id_seq OWNED BY public.purchase_order.purchase_id;

ALTER SEQUENCE public.account_acc_id_seq_2 OWNED BY public.purchase_order.account_id;

CREATE SEQUENCE public.payment_id_seq;

CREATE TABLE public.payment (
                id INTEGER NOT NULL DEFAULT nextval('public.payment_id_seq'),
                total REAL NOT NULL,
                details VARCHAR NOT NULL,
                payment_date DATE NOT NULL,
                account_id INTEGER NOT NULL,
                purchase_id INTEGER NOT NULL,
                CONSTRAINT payment_pk PRIMARY KEY (id)
);


ALTER SEQUENCE public.payment_id_seq OWNED BY public.payment.id;

CREATE TABLE public.pay_check (
                id INTEGER NOT NULL,
                name VARCHAR NOT NULL,
                bankId VARCHAR NOT NULL,
                CONSTRAINT payement_id PRIMARY KEY (id)
);


CREATE TABLE public.cash (
                id INTEGER NOT NULL,
                cash_tendered REAL NOT NULL,
                CONSTRAINT cash_pk PRIMARY KEY (id)
);


CREATE TABLE public.credit_card (
                id INTEGER NOT NULL,
                number VARCHAR NOT NULL,
                type VARCHAR NOT NULL,
                exp_date DATE NOT NULL,
                CONSTRAINT credit_card_pk PRIMARY KEY (id)
);


CREATE SEQUENCE public.line_items_lineitem_id_seq;

CREATE TABLE public.line_items (
                lineItem_id INTEGER NOT NULL DEFAULT nextval('public.line_items_lineitem_id_seq'),
                quantity INTEGER NOT NULL,
                price DOUBLE PRECISION NOT NULL,
                ref_pizza INTEGER NOT NULL,
                purchase_id INTEGER NOT NULL,
                CONSTRAINT line_items_pk PRIMARY KEY (lineItem_id)
);


ALTER SEQUENCE public.line_items_lineitem_id_seq OWNED BY public.line_items.lineItem_id;

CREATE TABLE public.staff (
                user_id INTEGER NOT NULL,
                pizzeria_number INTEGER NOT NULL,
                staff_role_code INTEGER NOT NULL,
                CONSTRAINT staff_pk PRIMARY KEY (user_id)
);


ALTER TABLE public.pricing ADD CONSTRAINT pizza_size_pricing_fk
FOREIGN KEY (ref_sizing)
REFERENCES public.sizing (ref)
ON DELETE NO ACTION
ON UPDATE NO ACTION
NOT DEFERRABLE;

ALTER TABLE public.purchase_order ADD CONSTRAINT order_status_purchase_order_fk
FOREIGN KEY (order_status_code)
REFERENCES public.order_status (code)
ON DELETE NO ACTION
ON UPDATE NO ACTION
NOT DEFERRABLE;

ALTER TABLE public.webuser ADD CONSTRAINT webuser_state_webuser_fk
FOREIGN KEY (webuser_state_code)
REFERENCES public.webuser_state (code)
ON DELETE NO ACTION
ON UPDATE NO ACTION
NOT DEFERRABLE;

ALTER TABLE public.staff ADD CONSTRAINT staff_role_staff_fk
FOREIGN KEY (staff_role_code)
REFERENCES public.role (code)
ON DELETE NO ACTION
ON UPDATE NO ACTION
NOT DEFERRABLE;

ALTER TABLE public.ingredient ADD CONSTRAINT unit_ingredients_fk
FOREIGN KEY (unit_id)
REFERENCES public.units (id)
ON DELETE NO ACTION
ON UPDATE NO ACTION
NOT DEFERRABLE;

ALTER TABLE public.purchase_order ADD CONSTRAINT invoice_purchaseorder_fk
FOREIGN KEY (invoice_number)
REFERENCES public.invoice (number)
ON DELETE NO ACTION
ON UPDATE NO ACTION
NOT DEFERRABLE;

ALTER TABLE public.recipe_ingredient ADD CONSTRAINT ingredients_recipe_ingredients_fk
FOREIGN KEY (ingredient_id)
REFERENCES public.ingredient (igd_id)
ON DELETE NO ACTION
ON UPDATE NO ACTION
NOT DEFERRABLE;

ALTER TABLE public.stock_ingredient ADD CONSTRAINT ingredients_stock_ingredient_fk
FOREIGN KEY (igd_id)
REFERENCES public.ingredient (igd_id)
ON DELETE NO ACTION
ON UPDATE NO ACTION
NOT DEFERRABLE;

ALTER TABLE public.line_items ADD CONSTRAINT pizzas_lineitem_fk
FOREIGN KEY (ref_pizza)
REFERENCES public.pizza (number)
ON DELETE NO ACTION
ON UPDATE NO ACTION
NOT DEFERRABLE;

ALTER TABLE public.pricing ADD CONSTRAINT pizza_pricing_fk
FOREIGN KEY (ref_pizza)
REFERENCES public.pizza (number)
ON DELETE NO ACTION
ON UPDATE NO ACTION
NOT DEFERRABLE;

ALTER TABLE public.recipe ADD CONSTRAINT pizza_recipe_fk
FOREIGN KEY (ref_pizza)
REFERENCES public.pizza (number)
ON DELETE NO ACTION
ON UPDATE NO ACTION
NOT DEFERRABLE;

ALTER TABLE public.description ADD CONSTRAINT pizza_description_fk
FOREIGN KEY (ref_pizza)
REFERENCES public.pizza (number)
ON DELETE NO ACTION
ON UPDATE NO ACTION
NOT DEFERRABLE;

ALTER TABLE public.webuser ADD CONSTRAINT address_user_fk
FOREIGN KEY (address_id)
REFERENCES public.address (id)
ON DELETE NO ACTION
ON UPDATE NO ACTION
NOT DEFERRABLE;

ALTER TABLE public.pizzeria ADD CONSTRAINT address_pizzeria_fk
FOREIGN KEY (address_id)
REFERENCES public.address (id)
ON DELETE NO ACTION
ON UPDATE NO ACTION
NOT DEFERRABLE;

ALTER TABLE public.staff ADD CONSTRAINT pizzeria_staff_fk
FOREIGN KEY (pizzeria_number)
REFERENCES public.pizzeria (number)
ON DELETE NO ACTION
ON UPDATE NO ACTION
NOT DEFERRABLE;

ALTER TABLE public.purchase_order ADD CONSTRAINT pizzeria_purchaseorder_fk
FOREIGN KEY (ref_pizzeria)
REFERENCES public.pizzeria (number)
ON DELETE NO ACTION
ON UPDATE NO ACTION
NOT DEFERRABLE;

ALTER TABLE public.menu_card ADD CONSTRAINT pizzeria_menu_card_fk
FOREIGN KEY (ref_pizzeria)
REFERENCES public.pizzeria (number)
ON DELETE NO ACTION
ON UPDATE NO ACTION
NOT DEFERRABLE;

ALTER TABLE public.memory_help ADD CONSTRAINT pizzeria_memory_help_fk
FOREIGN KEY (ref_pizzeria)
REFERENCES public.pizzeria (number)
ON DELETE NO ACTION
ON UPDATE NO ACTION
NOT DEFERRABLE;

ALTER TABLE public.stocks ADD CONSTRAINT pizzeria_stocks_fk
FOREIGN KEY (pizzeria_number)
REFERENCES public.pizzeria (number)
ON DELETE NO ACTION
ON UPDATE NO ACTION
NOT DEFERRABLE;

ALTER TABLE public.stock_ingredient ADD CONSTRAINT stocks_stock_ingredient_fk
FOREIGN KEY (stock_id)
REFERENCES public.stocks (stock_id)
ON DELETE NO ACTION
ON UPDATE NO ACTION
NOT DEFERRABLE;

ALTER TABLE public.recipe ADD CONSTRAINT memory_help_recipe_fk
FOREIGN KEY (mm_helf_ref)
REFERENCES public.memory_help (id)
ON DELETE NO ACTION
ON UPDATE NO ACTION
NOT DEFERRABLE;

ALTER TABLE public.recipe_ingredient ADD CONSTRAINT recipes_recipe_ingredients_fk
FOREIGN KEY (recipe_id)
REFERENCES public.recipe (id)
ON DELETE NO ACTION
ON UPDATE NO ACTION
NOT DEFERRABLE;

ALTER TABLE public.description ADD CONSTRAINT menucard_description_fk
FOREIGN KEY (ref_menu_card)
REFERENCES public.menu_card (id)
ON DELETE NO ACTION
ON UPDATE NO ACTION
NOT DEFERRABLE;

ALTER TABLE public.staff ADD CONSTRAINT user_staff_fk
FOREIGN KEY (user_id)
REFERENCES public.webuser (id)
ON DELETE NO ACTION
ON UPDATE NO ACTION
NOT DEFERRABLE;

ALTER TABLE public.customer ADD CONSTRAINT user_customer_fk
FOREIGN KEY (user_id)
REFERENCES public.webuser (id)
ON DELETE NO ACTION
ON UPDATE NO ACTION
NOT DEFERRABLE;

ALTER TABLE public.account ADD CONSTRAINT customer_account_fk
FOREIGN KEY (ref_customer)
REFERENCES public.customer (user_id)
ON DELETE NO ACTION
ON UPDATE NO ACTION
NOT DEFERRABLE;

ALTER TABLE public.purchase_order ADD CONSTRAINT account_purchaseorder_fk
FOREIGN KEY (account_id)
REFERENCES public.account (acc_id)
ON DELETE NO ACTION
ON UPDATE NO ACTION
NOT DEFERRABLE;

ALTER TABLE public.payment ADD CONSTRAINT account_payement_fk
FOREIGN KEY (account_id)
REFERENCES public.account (acc_id)
ON DELETE NO ACTION
ON UPDATE NO ACTION
NOT DEFERRABLE;

ALTER TABLE public.line_items ADD CONSTRAINT purchaseorder_lineitem_fk
FOREIGN KEY (purchase_id)
REFERENCES public.purchase_order (purchase_id)
ON DELETE NO ACTION
ON UPDATE NO ACTION
NOT DEFERRABLE;

ALTER TABLE public.payment ADD CONSTRAINT purchaseorder_payement_fk
FOREIGN KEY (purchase_id)
REFERENCES public.purchase_order (purchase_id)
ON DELETE NO ACTION
ON UPDATE NO ACTION
NOT DEFERRABLE;

ALTER TABLE public.credit_card ADD CONSTRAINT payment_credit_card_fk
FOREIGN KEY (id)
REFERENCES public.payment (id)
ON DELETE NO ACTION
ON UPDATE NO ACTION
NOT DEFERRABLE;

ALTER TABLE public.cash ADD CONSTRAINT payment_cash_fk
FOREIGN KEY (id)
REFERENCES public.payment (id)
ON DELETE NO ACTION
ON UPDATE NO ACTION
NOT DEFERRABLE;

ALTER TABLE public.pay_check ADD CONSTRAINT payment_pay_check_fk
FOREIGN KEY (id)
REFERENCES public.payment (id)
ON DELETE NO ACTION
ON UPDATE NO ACTION
NOT DEFERRABLE;
